<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìº í¼ìŠ¤ í—¬í¼ - ë°°ì¬ëŒ€í•™êµ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
        }

        /* Navigation Styles */
        nav {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
        }

        .nav-brand {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            gap: 0;
            list-style: none;
        }

        .nav-link {
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 8px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .nav-link.active {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        /* Main Content Styles */
        main {
            padding: 40px 30px;
        }

        .section-hidden {
            display: none !important;
        }

        section {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #333;
            text-align: center;
            font-weight: 700;
        }

        /* Dashboard (Quick Access) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .dashboard-card {
            display: block;
            text-decoration: none;
            color: #333;
            background: linear-gradient(#f8f9ff, #f8f9ff) padding-box,
                        linear-gradient(135deg, #667eea, #764ba2) border-box;
            border: 2px solid transparent;
            border-radius: 14px;
            padding: 16px 14px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(102, 126, 234, 0.15);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(118, 75, 162, 0.25);
        }

        .dashboard-card:focus-visible {
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.35);
        }

        .dashboard-icon {
            font-size: 2rem;
            line-height: 1;
            margin-bottom: 8px;
        }

        .dashboard-card h3 {
            font-size: 1rem;
            font-weight: 700;
        }

        /* Tablet/Desktop layout for dashboard */
        @media (min-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
                margin-bottom: 24px;
            }
            .dashboard-card h3 {
                font-size: 1.05rem;
            }
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group select,
        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Button Styles */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-large {
            padding: 20px 40px;
            font-size: 1.2rem;
            margin: 20px auto;
            display: block;
        }

        /* Time Buttons */
        .time-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }

        .time-btn {
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 8px;
            background: white;
            color: #555;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-btn:hover {
            border-color: #667eea;
            background: #f8f9ff;
            color: #667eea;
        }

        .time-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        /* Card Styles */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .card {
            background: white;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .card-content {
            color: #666;
            font-size: 0.95rem;
        }

        /* Stats */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }

        /* Chart Container */
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-top: 30px;
            min-height: 400px; /* ëª¨ë°”ì¼ ê°€ë¡œ ì°¨íŠ¸ì— ì¶©ë¶„í•œ ë†’ì´ í™•ë³´ */
        }

        #heatmap-chart {
            max-height: 400px; /* ëª¨ë°”ì¼ì—ì„œ ìŠ¤í¬ë¡¤ ë°©ì§€ */
        }

        /* Roulette Result */
        .roulette-result {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 10px 30px rgba(255, 107, 107, 0.3);
        }

        .roulette-result h3 {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .roulette-result p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Search Container */
        .search-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .search-info {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-size: 0.95rem;
            color: #0c5460;
        }

        .search-info p {
            margin: 5px 0;
        }

        /* êµìˆ˜ë‹˜ ì‹œê°„í‘œ ìŠ¤íƒ€ì¼ */
        .timetable-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            margin-top: 30px;
            border: 2px solid #e1e8ed;
            overflow-x: auto; /* ê¸°ë³¸ê°’: í•„ìš” ì‹œ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
            -webkit-overflow-scrolling: touch;
        }

        /* ì‹œê°„í‘œ ìë™ ì¶•ì†Œìš© ë˜í¼: ë‚´ë¶€ ê·¸ë¦¬ë“œë¥¼ ì ˆëŒ€ ìœ„ì¹˜ë¡œ ë‘ê³ , ë˜í¼ ë†’ì´ì— ìŠ¤ì¼€ì¼ ë°˜ì˜ */
        .timetable-scale-wrap {
            position: relative;
            width: 100%;
            overflow: hidden; /* ìŠ¤ì¼€ì¼ í›„ ë„˜ì¹¨ ì œê±° */
        }

        .timetable-scale-wrap > .timetable-grid-30 {
            position: absolute;
            left: 0;
            top: 0;
            transform-origin: top left;
        }

        .timetable-header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .timetable-header h3 {
            margin: 0;
            font-size: 1.3rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }

        /* MOBILE-FIRST: ë¹„ìœ¨í˜• ì‹œê°„í‘œ (30ë¶„ ë‹¨ìœ„) - ê·¸ë¦¬ë“œ ìœ ì§€ */
        .timetable-grid-30 {
            display: grid;
            grid-template-columns: 60px repeat(5, minmax(120px, 1fr));
            grid-template-rows: 44px repeat(18, var(--slot-height, 28px));
            gap: 0;
            background: #dee2e6;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #cfd4da;
            min-width: 720px; /* ì›”~ê¸ˆ 5ì—´ + ì‹œê°„ ë¼ë²¨ 1ì—´ ê¸°ë³¸ ìµœì†Œ ë„ˆë¹„ */
        }

        .timetable-header-cell,
        .time-label {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
            color: #495057;
            padding: 8px;
            font-weight: 700;
            font-size: 0.85rem;
            border-right: 1px solid #e9ecef;
            border-bottom: 1px solid #e9ecef;
        }

        .class-block {
            background: white;
            border: 2px solid #667eea;
            border-left: 5px solid #667eea;
            border-radius: 8px;
            padding: 14px;
            font-size: 0.9rem;
            display: flex;
            flex-direction: column;
            gap: 8px;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.15);
            transition: all 0.3s ease;
            position: relative;
            background: linear-gradient(to right, #f8f9ff 0%, white 100%);
        }

        /* ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ê³µí†µ: ë¸”ë¡ ìƒë‹¨ ë¼ë²¨ì€ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (í—¤ë”/ë¼ë²¨ ê·¸ë¦¬ë“œë¡œ ëŒ€ì²´) */
        .class-block::before { display: none; }

        .class-block:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.3);
            border-color: #764ba2;
        }

        .class-subject {
            font-weight: 700;
            font-size: 1rem;
            color: #333;
            line-height: 1.3;
        }

        .class-room {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .class-room::before {
            content: "ğŸ“";
            font-size: 0.9rem;
        }

        /* MOBILE-FIRST: ê¸°ì¡´ ê³ ì • ê·¸ë¦¬ë“œ ì‹œê°„í‘œ - ì„¸ë¡œ ë¦¬ìŠ¤íŠ¸ */
        .timetable-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: transparent;
        }

        .time-header,
        .day-header {
            display: none; /* ëª¨ë°”ì¼ì—ì„œëŠ” í—¤ë” ìˆ¨ê¹€ */
        }

        .time-slot {
            background: white;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 0.9rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.06);
        }

        .time-slot.has-class {
            background: linear-gradient(135deg, #667eea15, #764ba215);
            border-left: 4px solid #667eea;
            transition: all 0.25s ease;
        }

        .time-slot.has-class:hover {
            background: linear-gradient(135deg, #667eea25, #764ba225);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .timetable-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
        }

        .timetable-stat {
            background: white;
            padding: 15px 12px;
            border-radius: 10px;
            text-align: center;
            border: 2px solid #e9ecef;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .timetable-stat:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
        }

        .timetable-stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 4px;
        }

        .timetable-stat-label {
            font-size: 0.85rem;
            color: #6c757d;
            font-weight: 600;
        }

        /* DESKTOP: ê°€ë¡œ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ ë³µì› (768px+) */
        @media (min-width: 768px) {
            .timetable-container {
                padding: 30px;
                max-width: 1100px;
                margin-left: auto;
                margin-right: auto;
            }

            .timetable-header h3 {
                font-size: 1.6rem;
            }

            .timetable-stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .timetable-stat {
                padding: 18px 15px;
            }

            .timetable-stat-number {
                font-size: 2rem;
            }

            .timetable-stat-label {
                font-size: 0.9rem;
            }

            .timetable-grid-30 {
                --slot-height: 40px; /* ë°ìŠ¤í¬í†±ì—ì„œ ë” ë„‰ë„‰í•œ ë†’ì´ */
            }

            /* ë¹„ìœ¨í˜• ì‹œê°„í‘œ: 30ë¶„ ê·¸ë¦¬ë“œ ë³µì› */
            .timetable-grid-30 {
                display: grid;
                grid-template-columns: 90px repeat(5, 1fr);
                grid-template-rows: 55px repeat(18, var(--slot-height, 45px));
                gap: 0;
                background: #dee2e6;
                border-radius: 12px;
                overflow: hidden;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                border: 2px solid #adb5bd;
            }

            .timetable-header-cell,
            .time-label {
                display: flex;
                align-items: center;
                justify-content: center;
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 12px 8px;
                font-weight: 700;
                font-size: 1rem;
                border-right: 1px solid rgba(255,255,255,0.2);
                border-bottom: 1px solid rgba(255,255,255,0.2);
            }

            .timetable-header-cell:last-child {
                border-right: none;
            }

            .time-label {
                background: #f8f9fa;
                color: #495057;
                font-size: 0.9rem;
                font-weight: 700;
                border-right: 2px solid #dee2e6;
                border-bottom: 1px solid #dee2e6;
            }

            .class-block {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
                padding: 12px 10px;
                font-size: 0.9rem;
                border-radius: 6px;
                box-shadow: inset 0 0 0 1px rgba(255,255,255,0.3),
                            0 2px 8px rgba(0,0,0,0.15);
                margin: 3px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                justify-content: center;
                gap: 6px;
            }

            .class-block:hover {
                background: linear-gradient(135deg, #764ba2, #667eea);
                box-shadow: inset 0 0 0 2px rgba(255,255,255,0.5),
                            0 4px 12px rgba(0,0,0,0.25);
                transform: scale(1.02);
                z-index: 10;
                cursor: pointer;
            }

            /* ë°ìŠ¤í¬í†±: ìš”ì¼/ì‹œê°„ ë¼ë²¨ ìˆ¨ê¹€ (ê·¸ë¦¬ë“œë¡œ í‘œí˜„) */
            .class-block::before {
                display: none;
            }

            .class-subject {
                font-size: 0.95rem;
                font-weight: 700;
                color: white;
                line-height: 1.3;
                text-shadow: 0 1px 2px rgba(0,0,0,0.2);
                word-break: keep-all;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                line-clamp: 2; /* í‘œì¤€ ì†ì„± ë³‘ê¸° */
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            }

            .class-room {
                font-size: 0.8rem;
                color: rgba(255,255,255,0.95);
                line-height: 1.4;
                display: flex;
                align-items: center;
                flex-wrap: wrap;
                gap: 3px;
            }

            .class-room::before {
                content: "ğŸ“";
                margin-right: 2px;
                font-size: 0.85rem;
            }

            .timetable-grid-30 {
                --slot-height: 45px; /* ë°ìŠ¤í¬í†±ì—ì„œ ì¶©ë¶„í•œ ë†’ì´ */
            }

            /* ê¸°ì¡´ ê³ ì • ê·¸ë¦¬ë“œ ì‹œê°„í‘œ: ê°€ë¡œ ê·¸ë¦¬ë“œ ë³µì› */
            .timetable-grid {
                display: grid;
                grid-template-columns: 100px repeat(5, 1fr);
                gap: 1px;
                background: #e1e8ed;
                border-radius: 10px;
                overflow: hidden;
            }

            .time-header,
            .day-header {
                display: flex;
                align-items: center;
                justify-content: center;
                background: #f8f9fa;
                padding: 15px 10px;
                font-weight: 600;
                color: #495057;
            }

            .time-slot {
                background: white;
                min-height: 60px;
                border: none;
                border-radius: 0;
                padding: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.9rem;
                font-weight: 500;
                box-shadow: none;
            }

            .time-slot.has-class {
                background: linear-gradient(135deg, #667eea20, #764ba220);
                border-left: 4px solid #667eea;
                flex-direction: column;
                cursor: pointer;
            }

            .time-slot.has-class:hover {
                background: linear-gradient(135deg, #667eea40, #764ba240);
                transform: scale(1.02);
            }

            .class-subject {
                font-weight: 600;
                font-size: 0.85rem;
                text-align: center;
                margin-bottom: 4px;
            }

            .class-room {
                font-size: 0.75rem;
                text-align: center;
            }

            /* ë°ìŠ¤í¬í†±: ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìµœì í™” */
            .chart-container {
                padding: 30px;
                min-height: 450px;
            }

            #heatmap-chart {
                max-height: 500px;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-container {
                flex-direction: column;
                gap: 20px;
            }

            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }

            main {
                padding: 30px 20px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .time-buttons {
                grid-template-columns: repeat(2, 1fr);
            }

            .search-form {
                grid-template-columns: 1fr;
            }

            /* ëª¨ë°”ì¼ì—ì„œëŠ” ê°€ë¡œ ìŠ¤í¬ë¡¤ì„ ì—†ì• ê³ (ê¸°ë³¸ì€ ìˆ¨ê¹€), ìë™ ì¶•ì†Œë¡œ í•œ í™”ë©´ì— ë§ì¶¤ */
            .timetable-container {
                overflow-x: hidden;
            }

            /* ëª¨ë°”ì¼ì—ì„œ ê·¸ë¦¬ë“œ ê¸°ë³¸ ê¸€ì í¬ê¸° ì•½ê°„ ì¶•ì†Œ (ìŠ¤ì¼€ì¼ ì „ ê°€ë…ì„± ë³´ì •) */
            .class-subject { font-size: 0.95rem; }
            .class-room { font-size: 0.8rem; }
        }

        /* Tablet/Desktop layout for dashboard */
        @media (min-width: 768px) {
            .dashboard-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
                margin-bottom: 24px;
            }
            .dashboard-card h3 {
                font-size: 1.05rem;
            }
            .timetable-grid-30 {
                --slot-height: 34px; /* ì¡°ê¸ˆ ë” ë„‰ë„‰í•œ ë†’ì´ */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav>
            <div class="nav-container">
                <div class="nav-brand" data-target="home" style="cursor: pointer;">ğŸ« ìº í¼ìŠ¤ í—¬í¼</div>
                <button id="menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°">â˜°</button>
                <ul class="nav-links">
                    <li><a class="nav-link active" data-target="home">ğŸ  ì‹¤ì‹œê°„ í˜„í™©</a></li>
                    <li><a class="nav-link" data-target="search">ğŸ” ë¹ˆ ê°•ì˜ì‹¤ ê²€ìƒ‰</a></li>
                    <li><a class="nav-link" data-target="schedule">ğŸ—“ï¸ ìŠ¤ì¼€ì¤„ ì¡°íšŒ</a></li>
                    <li><a class="nav-link" data-target="heatmap">ğŸ“Š ìº í¼ìŠ¤ í˜¼ì¡ë„</a></li>
                    <li><a class="nav-link" data-target="roulette">ğŸ” ì ì‹¬ ë£°ë ›</a></li>
                </ul>
            </div>
        </nav>

        <main>
            <!-- ì‹¤ì‹œê°„ í˜„í™© ì„¹ì…˜ -->
            <section id="home">
                <div class="dashboard-grid">
                    <a class="dashboard-card" data-target="search">
                        <div class="dashboard-icon">ğŸ”</div>
                        <h3>ë¹ˆ ê°•ì˜ì‹¤ ê²€ìƒ‰</h3>
                    </a>
                    <a class="dashboard-card" data-target="schedule">
                        <div class="dashboard-icon">ğŸ—“ï¸</div>
                        <h3>ìŠ¤ì¼€ì¤„ ì¡°íšŒ</h3>
                    </a>
                    <a class="dashboard-card" data-target="heatmap">
                        <div class="dashboard-icon">ğŸ“Š</div>
                        <h3>ìº í¼ìŠ¤ í˜¼ì¡ë„</h3>
                    </a>
                    <a class="dashboard-card" data-target="roulette">
                        <div class="dashboard-icon">ğŸ”</div>
                        <h3>ì ì‹¬ ë£°ë ›</h3>
                    </a>
                </div>
                <h1 class="section-title">ğŸ“Š ì‹¤ì‹œê°„ ìº í¼ìŠ¤ í˜„í™©</h1>
                <div class="stats-container" id="current-stats">
                    <!-- í†µê³„ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
                <div class="card-grid" id="current-rooms">
                    <!-- í˜„ì¬ ìƒí™© ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- ë¹ˆ ê°•ì˜ì‹¤ ê²€ìƒ‰ ì„¹ì…˜ -->
            <section id="search" class="section-hidden">
                <h1 class="section-title">ğŸ” ë¹ˆ ê°•ì˜ì‹¤ ê²€ìƒ‰</h1>
                <div class="search-container">
                    <div class="search-form">
                        <div class="form-group">
                            <label for="day-select">ğŸ“… ìš”ì¼ ì„ íƒ</label>
                            <select id="day-select">
                                <option value="">ìš”ì¼ì„ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="MON">ì›”ìš”ì¼</option>
                                <option value="TUE">í™”ìš”ì¼</option>
                                <option value="WED">ìˆ˜ìš”ì¼</option>
                                <option value="THU">ëª©ìš”ì¼</option>
                                <option value="FRI">ê¸ˆìš”ì¼</option>
                                <option value="SAT">í† ìš”ì¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>â° ì‹œê°„ ì„ íƒ</label>
                            <div class="time-buttons">
                                <button type="button" class="time-btn" data-time="09:00">1êµì‹œ (09:00)</button>
                                <button type="button" class="time-btn" data-time="10:00">2êµì‹œ (10:00)</button>
                                <button type="button" class="time-btn" data-time="11:00">3êµì‹œ (11:00)</button>
                                <button type="button" class="time-btn" data-time="13:00">4êµì‹œ (13:00)</button>
                                <button type="button" class="time-btn" data-time="14:00">5êµì‹œ (14:00)</button>
                                <button type="button" class="time-btn" data-time="15:00">6êµì‹œ (15:00)</button>
                                <button type="button" class="time-btn" data-time="16:00">7êµì‹œ (16:00)</button>
                                <button type="button" class="time-btn" data-time="18:00">ì•¼ê°„ (18:00)</button>
                            </div>
                            <input type="time" id="time-select" value="09:00">
                        </div>
                        <div class="form-group">
                            <button class="btn" id="search-button">ğŸ” ê²€ìƒ‰</button>
                        </div>
                    </div>
                </div>
                <div class="card-grid" id="search-results">
                    <!-- ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- ìŠ¤ì¼€ì¤„ ì¡°íšŒ ì„¹ì…˜ -->
            <section id="schedule" class="section-hidden">
                <h1 class="section-title">ğŸ—“ï¸ ìŠ¤ì¼€ì¤„ ì¡°íšŒ</h1>
                <div class="search-container">
                    <div class="search-form">
                        <div class="form-group">
                            <label for="schedule-type">ê²€ìƒ‰ íƒ€ì…</label>
                            <select id="schedule-type">
                                <option value="department">í•™ê³¼ë³„ ê²€ìƒ‰</option>
                                <option value="professor">êµìˆ˜ë³„ ê²€ìƒ‰</option>
                                <option value="classroom">ê°•ì˜ì‹¤ë³„ ê²€ìƒ‰</option>
                                <option value="subject">ê³¼ëª©ëª… ê²€ìƒ‰</option>
                                <option value="professor-timetable">êµìˆ˜ë‹˜ ì‹œê°„í‘œ</option>
                                <option value="missing-professor">êµìˆ˜ëª… ëˆ„ë½ ê°•ì˜</option>
                            </select>
                        </div>
                        <div class="form-group" id="search-input-group">
                            <label for="schedule-query">ê²€ìƒ‰ì–´</label>
                            <input type="text" id="schedule-query" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                        </div>
                        <div class="form-group" id="professor-select-group" style="display: none;">
                            <label for="professor-select">êµìˆ˜ë‹˜ ì„ íƒ</label>
                            <select id="professor-select">
                                <option value="">êµìˆ˜ë‹˜ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="schedule-day-filter">ìš”ì¼ í•„í„°</label>
                            <select id="schedule-day-filter">
                                <option value="">ì „ì²´ ìš”ì¼</option>
                                <option value="MON">ì›”ìš”ì¼</option>
                                <option value="TUE">í™”ìš”ì¼</option>
                                <option value="WED">ìˆ˜ìš”ì¼</option>
                                <option value="THU">ëª©ìš”ì¼</option>
                                <option value="FRI">ê¸ˆìš”ì¼</option>
                                <option value="SAT">í† ìš”ì¼</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <button class="btn" id="schedule-search-button">ğŸ” ê²€ìƒ‰</button>
                        </div>
                    </div>
                </div>
                <div class="card-grid" id="schedule-results">
                    <!-- ìŠ¤ì¼€ì¤„ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
                <div class="card-grid" id="online-courses-list">
                    <!-- ì˜¨ë¼ì¸ ê°•ì˜ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </section>

            <!-- ìº í¼ìŠ¤ í˜¼ì¡ë„ ì„¹ì…˜ -->
            <section id="heatmap" class="section-hidden">
                <h1 class="section-title">ğŸ“Š ìº í¼ìŠ¤ í˜¼ì¡ë„</h1>
                <div class="chart-container">
                    <canvas id="heatmap-chart"></canvas>
                </div>
            </section>

            <!-- ì ì‹¬ ë£°ë › ì„¹ì…˜ -->
            <section id="roulette" class="section-hidden">
                <h1 class="section-title">ğŸ” ì ì‹¬ ë£°ë ›</h1>
                <div style="text-align: center;">
                    <p style="font-size: 1.2rem; margin-bottom: 30px; color: #666;">
                        ì˜¤ëŠ˜ ì ì‹¬ ë©”ë‰´ë¥¼ ì •í•˜ì§€ ëª»í•˜ì…¨ë‚˜ìš”?<br>
                        ë£°ë ›ì„ ëŒë ¤ì„œ ë§›ìˆëŠ” ì ì‹¬ì„ ì¶”ì²œë°›ì•„ë³´ì„¸ìš”!
                    </p>
                    <button class="btn btn-large" id="roulette-button">ğŸ° ë£°ë › ëŒë¦¬ê¸°</button>
                </div>
                <div id="roulette-result"></div>
            </section>
        </main>
    </div>

    <script>
        // ===== ë°ì´í„° ì •ì˜ =====
        // ë°°ì¬ëŒ€í•™êµ 2025í•™ë…„ë„ 2í•™ê¸° ì‹¤ì œ ê°•ì˜ ì‹œê°„í‘œ ë°ì´í„°
        let timetableData = [];
        let professorsList = [];

        // ê±´ë¬¼ ì½”ë“œ â†’ í‘œì¤€ ê±´ë¬¼ëª… ë§¤í•‘ (ê°œì„¤ê°•ì¢Œ ë¦¬ìŠ¤íŠ¸ ê¸°ì¤€)
        const BUILDING_NAME_MAP = {
            "505": "505ê´€",
            "A": "ì•„íœì ¤ëŸ¬ê´€",
            "AM": "ì•„íœì ¤ëŸ¬ê¸°ë…ê´€",
            "AU": "AUê´€",
            "B": "ë°±ì‚°ê´€",
            "C": "Cê´€",
            "DC": "ëŒ€ë•ì‚°í•™í˜‘ë ¥ê´€",
            "DS": "ëŒ€ë•ì‚°í•™í˜‘ë ¥ê´€",
            "F": "ì„œì¬í•„ê´€",
            "G": "êµ­ì œêµë¥˜ê´€",
            "H": "í•˜ì›Œë“œê´€",
            "HM": "í•˜ì›Œë“œê¸°ë…ê´€",
            "J": "Jê´€",
            "JU": "Jê´€ì§€í•˜",
            "K": "ê¹€ì˜¥ê· ê´€",
            "MC": "Më™",
            "P": "21ì„¸ê¸°ê´€",
            "PAU": "êµ­ì œì–¸ì–´ìƒí™œê´€ì§€í•˜",
            "PU": "21ì„¸ê¸°ê´€ì§€í•˜",
            "S": "ì†Œì›”ê´€",
            "SP": "SMARTë°°ì¬ê´€",
            "W": "ìš°ë‚¨ê´€",
            "Y": "Yê´€",
            "ZY": "ZYê´€"
        };

        // í‘œì‹œìš©: êµìˆ˜ëª… ë°°ì—´ í•„ë“œê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
        function getProfessorDisplay(item) {
            if (Array.isArray(item.professors) && item.professors.length > 0) {
                return item.professors.join(', ');
            }
            return item.professor || '';
        }

        function getRoomDisplay(item) {
            if (item.day === 'ONLINE' || String(item.type||'').toLowerCase() === 'online') {
                return 'ì˜¨ë¼ì¸';
            }
            const b = (item.building_name || '').trim();
            const r = (item.classroom || '').trim();
            if (b && r) return `${b} ${r}`;
            if (b) return b;
            if (r) return r;
            return '-';
        }

    // JSON íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ
    async function loadTimetableData() {
            try {
                // ê³µì‹ ë°ì´í„° ì†ŒìŠ¤: timetable_project.json ì‚¬ìš©
                const response = await fetch('timetable_project.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const raw = await response.json();

                // ì •ê·œí™” ë° ê±´ë¬¼ëª… êµì²´: building_code ê¸°ì¤€ìœ¼ë¡œ í‘œì¤€ ê±´ë¬¼ëª… ì ìš©
                timetableData = raw.map(item => {
                    const code = (item.building_code || '').trim();
                    const correctedName = BUILDING_NAME_MAP[code] || (item.building_name || '').trim();
                    // start/end ì—†ê³  timeë§Œ ìˆëŠ” ë ˆì½”ë“œëŠ” ë¶„ë¦¬
                    let start = item.start, end = item.end;
                    if ((!start || !end) && item.time && item.time.includes('-')) {
                        const [s, e] = item.time.split('-');
                        start = (s || '').trim();
                        end = (e || '').trim();
                    }
                    return { ...item, building_name: correctedName, start, end };
                });
                
                // êµìˆ˜ë‹˜ ëª©ë¡ ìƒì„± (ì´ë¦„ì´ ìˆëŠ” ê²½ìš°ë§Œ)
                const professorsSet = new Set();
                let missingProfessorCount = 0;
                
                timetableData.forEach(item => {
                    const single = (item.professor || '').trim();
                    const multi = Array.isArray(item.professors) ? item.professors : [];
                    
                    // professors ë°°ì—´ì´ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©
                    if (multi.length > 0) {
                        multi.forEach(name => {
                            const n = String(name || '').trim();
                            if (n && !['01','02','03','04','05','06','07','08','09','10'].includes(n)) {
                                professorsSet.add(n);
                            }
                        });
                    }
                    // single professor í•„ë“œ ì‚¬ìš© (ë¶„ë°˜ ë²ˆí˜¸ ì œì™¸)
                    if (single && !['','01','02','03','04','05','06','07','08','09','10'].includes(single)) {
                        professorsSet.add(single);
                    }
                    
                    // ë‘˜ ë‹¤ ì—†ìœ¼ë©´ ëˆ„ë½
                    if (!single && multi.length === 0) {
                        missingProfessorCount++;
                    }
                });
                professorsList = Array.from(professorsSet).sort();
                
                console.log(`êµìˆ˜ë‹˜ ì´ë¦„ ëˆ„ë½ëœ ê°•ì˜: ${missingProfessorCount}ê°œ`);
                
                // êµìˆ˜ë‹˜ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
                populateProfessorDropdown();
                
                const onlineCount = timetableData.filter(i => i.day === 'ONLINE' || (i.type || '').toLowerCase() === 'online').length;
                console.log(`ì‹œê°„í‘œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ: ${timetableData.length}ê°œ ê°•ì˜, ${professorsList.length}ëª… êµìˆ˜ (ì˜¨ë¼ì¸ ${onlineCount}ê°œ)`);
                
                // ë°ì´í„° ë¡œë“œ í›„ í˜„ì¬ ì„¹ì…˜ ë‹¤ì‹œ ì´ˆê¸°í™”
                const activeNavLink = document.querySelector('.nav-link.active');
                if (activeNavLink) {
                    const currentSection = activeNavLink.getAttribute('data-target');
                    initializeSection(currentSection);
                }
            } catch (error) {
                console.error('ì‹œê°„í‘œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ë¹ˆ ë°°ì—´ë¡œ ì„¤ì •
                timetableData = [];
                alert('ì‹œê°„í‘œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        }

        // ë°°ì¬ëŒ€í•™êµ ì£¼ë³€ ë§›ì§‘ ë°ì´í„° (ì˜ˆì‹œ)
        const restaurantsData = [
            { "name": "ë°°ì¬í•™ì‹ë‹¹", "category": "í•œì‹", "menu": "ê¹€ì¹˜ì°Œê°œ, ëœì¥ì°Œê°œ, ë¶ˆê³ ê¸°ì •ì‹" },
            { "name": "ëŒ€ì „ ëª…ë™ì¹¼êµ­ìˆ˜", "category": "í•œì‹", "menu": "ì¹¼êµ­ìˆ˜, ë§Œë‘, ë¹„ë¹”êµ­ìˆ˜" },
            { "name": "ì²­ì¶˜ë°˜ì ", "category": "ì¤‘ì‹", "menu": "ì§œì¥ë©´, ì§¬ë½•, íƒ•ìˆ˜ìœ¡" },
            { "name": "í™ì½©ë°˜ì ", "category": "ì¤‘ì‹", "menu": "ë³¶ìŒë°¥, ê¹í’ê¸°, ìœ ë¦°ê¸°" },
            { "name": "ëˆê¹ŒìŠ¤ ëª…ê°€", "category": "ì¼ì‹", "menu": "ë“±ì‹¬ëˆê¹ŒìŠ¤, ì¹˜ì¦ˆëˆê¹ŒìŠ¤, ìš°ë™" },
            { "name": "ì´ˆë°¥ì˜ë‹¬ì¸", "category": "ì¼ì‹", "menu": "ëª¨ë“¬ì´ˆë°¥, ì—°ì–´ì´ˆë°¥, íšŒë®ë°¥" },
            { "name": "ë§˜ìŠ¤í„°ì¹˜ ë°°ì¬ëŒ€ì ", "category": "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ", "menu": "ì‹¸ì´ë²„ê±°, ì¹˜í‚¨ë²„ê±°, ê°ìíŠ€ê¹€" },
            { "name": "ë§¥ë„ë‚ ë“œ ëŒ€ì „ìš©ë¬¸ì ", "category": "íŒ¨ìŠ¤íŠ¸í‘¸ë“œ", "menu": "ë¹…ë§¥, ìƒˆìš°ë²„ê±°, ë§¥ë„ˆê²Ÿ" },
            { "name": "ì»¤í”¼ë² ë„¤ ë°°ì¬ëŒ€ì ", "category": "ì¹´í˜", "menu": "ì•„ë©”ë¦¬ì¹´ë…¸, ì¹´í˜ë¼ë–¼, ìƒŒë“œìœ„ì¹˜" },
            { "name": "ìŠ¤íƒ€ë²…ìŠ¤ ëŒ€ì „ìš©ë¬¸ì ", "category": "ì¹´í˜", "menu": "ì•„ë©”ë¦¬ì¹´ë…¸, í”„ë¼í‘¸ì¹˜ë…¸, ë¨¸í•€" },
            { "name": "êµì´Œì¹˜í‚¨ ìš©ë¬¸ì ", "category": "ì¹˜í‚¨", "menu": "í—ˆë‹ˆì½¤ë³´, ë ˆë“œì½¤ë³´, ê°„ì¥ì¹˜í‚¨" },
            { "name": "ë„¤ë„¤ì¹˜í‚¨ ëŒ€ì „ìš©ë¬¸ì ", "category": "ì¹˜í‚¨", "menu": "ì–‘ë…ì¹˜í‚¨, í›„ë¼ì´ë“œ, ë°˜ë°˜ì¹˜í‚¨" },
            { "name": "í”¼ìí—› ëŒ€ì „ìš©ë¬¸ì ", "category": "í”¼ì", "menu": "ìŠˆí¼ìŠˆí”„ë¦¼, ë¶ˆê³ ê¸°í”¼ì, ì½¤ë¹„ë„¤ì´ì…˜" },
            { "name": "ë„ë¯¸ë…¸í”¼ì ìš©ë¬¸ì ", "category": "í”¼ì", "menu": "í˜í¼ë¡œë‹ˆ, í¬í…Œì´í† , ì¹˜ì¦ˆí”¼ì" },
            { "name": "êµ­ë°¥ì²œêµ­", "category": "í•œì‹", "menu": "ìˆœëŒ€êµ­ë°¥, ë¼ì§€êµ­ë°¥, ë‚´ì¥êµ­ë°¥" },
            { "name": "ìš©ë¬¸ê°ˆë¹„ì§‘", "category": "í•œì‹", "menu": "ê°ˆë¹„íƒ•, ê°ˆë¹„êµ¬ì´, ëƒ‰ë©´" },
            { "name": "ë¶„ì‹ì²œêµ­", "category": "ë¶„ì‹", "menu": "ë–¡ë³¶ì´, ê¹€ë°¥, ìˆœëŒ€" },
            { "name": "24ì‹œê°„ ê¹€ë°¥ì²œêµ­", "category": "ë¶„ì‹", "menu": "ì°¸ì¹˜ê¹€ë°¥, ì œìœ¡ê¹€ë°¥, ë¼ë©´" },
            { "name": "íŒŒìŠ¤íƒ€í´ëŸ½", "category": "ì–‘ì‹", "menu": "í¬ë¦¼íŒŒìŠ¤íƒ€, í† ë§ˆí† íŒŒìŠ¤íƒ€, ë¦¬ì¡°ë˜" },
            { "name": "ì‰í”„ì˜ì •ì›", "category": "ì–‘ì‹", "menu": "ìŠ¤í…Œì´í¬, íŒŒìŠ¤íƒ€, ìƒëŸ¬ë“œ" }
        ];

        // ===== 3.1. SPA ë‚´ë¹„ê²Œì´ì…˜ ë¡œì§ =====
        document.addEventListener('DOMContentLoaded', async function() {
            // JSON ë°ì´í„° ë¨¼ì € ë¡œë“œ
            await loadTimetableData();
            
            // í–„ë²„ê±° ë©”ë‰´ í† ê¸€
            const menuToggle = document.getElementById('menu-toggle');
            const nav = document.querySelector('nav');
            
            if (menuToggle) {
                menuToggle.addEventListener('click', function() {
                    nav.classList.toggle('nav-open');
                });
            }
            
            // ë¡œê³  í´ë¦­ ì‹œ í™ˆìœ¼ë¡œ ì´ë™
            const navBrand = document.querySelector('.nav-brand');
            if (navBrand) {
                navBrand.addEventListener('click', function() {
                    // í™ˆ ë§í¬ ì°¾ì•„ì„œ í´ë¦­ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
                    const homeLink = document.querySelector('[data-target="home"]');
                    if (homeLink && homeLink.classList.contains('nav-link')) {
                        homeLink.click();
                    }
                });
            }
            
            // ë‚´ë¹„ê²Œì´ì…˜ ë§í¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            const navLinks = document.querySelectorAll('[data-target]');
            const sections = document.querySelectorAll('section');

            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('data-target');

                    // ëª¨ë°”ì¼: ë©”ë‰´ ë‹«ê¸°
                    if (nav) {
                        nav.classList.remove('nav-open');
                    }

                    // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
                    sections.forEach(section => {
                        section.classList.add('section-hidden');
                    });

                    // ëª¨ë“  ë§í¬ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
                    navLinks.forEach(navLink => {
                        navLink.classList.remove('active');
                    });

                    // ì„ íƒëœ ì„¹ì…˜ ë³´ì´ê¸°
                    const targetSection = document.getElementById(targetId);
                    if (targetSection) {
                        targetSection.classList.remove('section-hidden');
                    }

                    // ì„ íƒëœ ë§í¬ì— active í´ë˜ìŠ¤ ì¶”ê°€
                    this.classList.add('active');

                    // ì„¹ì…˜ë³„ ì´ˆê¸°í™” í•¨ìˆ˜ í˜¸ì¶œ
                    initializeSection(targetId);
                });
            });

            // ì´ˆê¸° ë¡œë“œ ì‹œ í™ˆ ì„¹ì…˜ ì´ˆê¸°í™”
            initializeSection('home');
            initializeSearchSection();
            initializeScheduleSection();
            initializeRouletteSection();
        });

        // ===== 3.2. ê¸°ëŠ¥ 1: ì‹¤ì‹œê°„ í˜„í™© (Home) =====
        function initializeSection(sectionId) {
            switch(sectionId) {
                case 'home':
                    updateRealTimeStatus();
                    break;
                case 'heatmap':
                    renderHeatmapChart();
                    break;
            }
        }

        function updateRealTimeStatus() {
            // ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œë”© í‘œì‹œ
            if (!timetableData || timetableData.length === 0) {
                const statsContainer = document.getElementById('current-stats');
                const roomsContainer = document.getElementById('current-rooms');
                
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number">â³</div>
                        <div class="stat-label">ë°ì´í„° ë¡œë”© ì¤‘...</div>
                    </div>
                `;
                
                roomsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">ğŸ“Š ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
                        <div class="card-content">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</div>
                    </div>
                `;
                return;
            }

            const now = new Date();
            const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];
            const currentDay = dayNames[now.getDay()];
            const currentTime = now.getHours().toString().padStart(2, '0') + ':' + 
                               now.getMinutes().toString().padStart(2, '0');

            // í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ê°•ì˜ì‹¤ ê³„ì‚°
            const occupiedRooms = timetableData.filter(item => {
                return item.day === currentDay && 
                       currentTime >= item.start && 
                       currentTime < item.end;
            });

            // ì „ì²´ ê°•ì˜ì‹¤ ëª©ë¡
            const allRooms = [...new Set(timetableData
                .map(item => `${(item.building_name||'').trim()}-${(item.classroom||'').trim()}`)
                .filter(key => key !== '-')
            )];

            // ë¹ˆ ê°•ì˜ì‹¤ ê³„ì‚°
            const occupiedRoomKeys = occupiedRooms.map(item => 
                `${(item.building_name||'').trim()}-${(item.classroom||'').trim()}`
            );
            const emptyRoomsCount = allRooms.length - occupiedRoomKeys.length;

            // í†µê³„ ì¹´ë“œ ë Œë”ë§
            const statsContainer = document.getElementById('current-stats');
            statsContainer.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${occupiedRooms.length}</div>
                    <div class="stat-label">ì‚¬ìš© ì¤‘ì¸ ê°•ì˜ì‹¤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${emptyRoomsCount}</div>
                    <div class="stat-label">ë¹ˆ ê°•ì˜ì‹¤</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${allRooms.length}</div>
                    <div class="stat-label">ì „ì²´ ê°•ì˜ì‹¤</div>
                </div>
            `;

            // í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê°•ì˜ ì¹´ë“œ ë Œë”ë§
            const roomsContainer = document.getElementById('current-rooms');
            if (occupiedRooms.length > 0) {
                const roomCards = occupiedRooms.map(room => `
                    <div class="card">
                        <div class="card-title">ğŸ›ï¸ ${getRoomDisplay(room)}</div>
                        <div class="card-content">
                            <strong>${room.subject}</strong><br>
                            ğŸ‘¨â€ğŸ« ${getProfessorDisplay(room)}<br>
                            ğŸ« ${room.department}<br>
                            â° ${room.start} - ${room.end}
                        </div>
                    </div>
                `).join('');
                roomsContainer.innerHTML = roomCards;
            } else {
                roomsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">ğŸ˜´ í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê°•ì˜ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="card-content">
                            í˜„ì¬ ì‹œê°„ì—ëŠ” ëª¨ë“  ê°•ì˜ì‹¤ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                `;
            }
        }

        // ===== 3.3. ê¸°ëŠ¥ 2: ë¹ˆ ê°•ì˜ì‹¤ ê²€ìƒ‰ (Search) =====
        function initializeSearchSection() {
            const searchButton = document.getElementById('search-button');
            const timeButtons = document.querySelectorAll('.time-btn');
            const timeSelect = document.getElementById('time-select');

            // ì‹œê°„ ë²„íŠ¼ ì´ë²¤íŠ¸
            timeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    timeButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    timeSelect.value = this.dataset.time;
                });
            });

            // ê²€ìƒ‰ ë²„íŠ¼ ì´ë²¤íŠ¸
            searchButton.addEventListener('click', function() {
                const selectedDay = document.getElementById('day-select').value;
                const selectedTime = timeSelect.value;

                if (!selectedDay) {
                    alert('ìš”ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!selectedTime) {
                    alert('ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                searchEmptyClassrooms(selectedDay, selectedTime);
            });
        }

        function searchEmptyClassrooms(selectedDay, selectedTime) {
            // ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê²½ê³ 
            if (!timetableData || timetableData.length === 0) {
                const resultsContainer = document.getElementById('search-results');
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
                        <div class="card-content">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>
                    </div>
                `;
                return;
            }

            // ì„ íƒëœ ì‹œê°„ì— ì‚¬ìš© ì¤‘ì¸ ê°•ì˜ì‹¤
            const occupiedRooms = timetableData.filter(item => {
                return item.day === selectedDay && 
                       selectedTime >= item.start && 
                       selectedTime < item.end;
            });

            const occupiedRoomKeys = occupiedRooms.map(item => 
                `${(item.building_name||'').trim()}-${(item.classroom||'').trim()}`
            );

            // ì „ì²´ ê°•ì˜ì‹¤ì—ì„œ ì‚¬ìš© ì¤‘ì¸ ê°•ì˜ì‹¤ ì œì™¸
            const allRoomsData = timetableData.reduce((acc, item) => {
                const key = `${(item.building_name||'').trim()}-${(item.classroom||'').trim()}`;
                if (!acc[key]) {
                    acc[key] = {
                        classroom: item.classroom,
                        building_name: item.building_name
                    };
                }
                return acc;
            }, {});

            const emptyRooms = Object.entries(allRoomsData)
                .filter(([key]) => !occupiedRoomKeys.includes(key))
                .map(([key, data]) => data);

            // ê²°ê³¼ ë Œë”ë§
            const resultsContainer = document.getElementById('search-results');
            const dayNames = {
                'MON': 'ì›”ìš”ì¼', 'TUE': 'í™”ìš”ì¼', 'WED': 'ìˆ˜ìš”ì¼',
                'THU': 'ëª©ìš”ì¼', 'FRI': 'ê¸ˆìš”ì¼', 'SAT': 'í† ìš”ì¼'
            };

            if (emptyRooms.length > 0) {
                const roomCards = emptyRooms.map(room => `
                    <div class="card">
                        <div class="card-title">ğŸ›ï¸ ${getRoomDisplay(room)}</div>
                        <div class="card-content">
                            â° ${dayNames[selectedDay]} ${selectedTime}
                        </div>
                    </div>
                `).join('');
                resultsContainer.innerHTML = roomCards;
            } else {
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">ğŸ˜” ë¹ˆ ê°•ì˜ì‹¤ì´ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="card-content">
                            í•´ë‹¹ ì‹œê°„ì—ëŠ” ëª¨ë“  ê°•ì˜ì‹¤ì´ ì‚¬ìš© ì¤‘ì…ë‹ˆë‹¤.
                        </div>
                    </div>
                `;
            }
        }

        // êµìˆ˜ë‹˜ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
        function populateProfessorDropdown() {
            const professorSelect = document.getElementById('professor-select');
            if (!professorSelect || professorsList.length === 0) return;
            
            // ê¸°ì¡´ ì˜µì…˜ë“¤ ì œê±° (ì²« ë²ˆì§¸ ê¸°ë³¸ ì˜µì…˜ ì œì™¸)
            professorSelect.innerHTML = '<option value="">êµìˆ˜ë‹˜ì„ ì„ íƒí•˜ì„¸ìš”</option>';
            
            // êµìˆ˜ë‹˜ë“¤ì„ ë“œë¡­ë‹¤ìš´ì— ì¶”ê°€
            professorsList.forEach(professor => {
                const option = document.createElement('option');
                option.value = professor;
                option.textContent = professor;
                professorSelect.appendChild(option);
            });
        }

        // ê²€ìƒ‰ íƒ€ì…ì— ë”°ë¼ UI í† ê¸€
        function toggleSearchUI() {
            const searchType = document.getElementById('schedule-type').value;
            const searchInputGroup = document.getElementById('search-input-group');
            const professorSelectGroup = document.getElementById('professor-select-group');
            
            if (searchType === 'professor-timetable') {
                searchInputGroup.style.display = 'none';
                professorSelectGroup.style.display = 'block';
            } else if (searchType === 'missing-professor') {
                // êµìˆ˜ëª… ëˆ„ë½ ê°•ì˜ëŠ” ê²€ìƒ‰ì–´ ì…ë ¥ ë¶ˆí•„ìš”
                searchInputGroup.style.display = 'none';
                professorSelectGroup.style.display = 'none';
            } else {
                searchInputGroup.style.display = 'block';
                professorSelectGroup.style.display = 'none';
            }
        }

        // ===== 3.4. ê¸°ëŠ¥ 3: ìŠ¤ì¼€ì¤„ ì¡°íšŒ (Schedule) =====
        function initializeScheduleSection() {
            const searchButton = document.getElementById('schedule-search-button');
            const searchQuery = document.getElementById('schedule-query');
            const searchType = document.getElementById('schedule-type');
            
            function performSearch() {
                const type = searchType.value;
                if (type === 'professor-timetable') {
                    const selectedProfessor = document.getElementById('professor-select').value;
                    if (selectedProfessor) {
                        showProfessorTimetable(selectedProfessor);
                    }
                } else if (type === 'missing-professor') {
                    // êµìˆ˜ëª… ëˆ„ë½ ê°•ì˜ëŠ” ê²€ìƒ‰ì–´ ì—†ì´ ë°”ë¡œ ê²€ìƒ‰
                    searchSchedule(type, '');
                } else {
                    const query = searchQuery.value.trim();
                    searchSchedule(type, query);
                }
            }
            
            searchButton.addEventListener('click', performSearch);
            
            // Enter í‚¤ë¡œ ê²€ìƒ‰ ì‹¤í–‰
            searchQuery.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });
            
            // ê²€ìƒ‰ íƒ€ì… ë³€ê²½ ì‹œ UI í† ê¸€
            searchType.addEventListener('change', toggleSearchUI);
            
            // ì´ˆê¸° UI ì„¤ì •
            toggleSearchUI();
        }

        // êµìˆ˜ë‹˜ ì‹œê°„í‘œ í‘œì‹œ
    function showProfessorTimetable(professorName) {
            if (!timetableData || timetableData.length === 0) {
                const resultsContainer = document.getElementById('schedule-results');
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
                        <div class="card-content">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>
                    </div>
                `;
                return;
            }

            // í•´ë‹¹ êµìˆ˜ë‹˜ì˜ ê°•ì˜ í•„í„°ë§ (êµìˆ˜ë‹˜ ì´ë¦„ì´ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ë§Œ)
            const professorClasses = timetableData.filter(item => {
                const p = item.professor && item.professor.trim();
                const ps = Array.isArray(item.professors) ? item.professors.map(x => (x || '').trim()).filter(Boolean) : [];
                return (p && p === professorName) || ps.includes(professorName);
            });

            if (professorClasses.length === 0) {
                const resultsContainer = document.getElementById('schedule-results');
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">ğŸ“‹ ê°•ì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="card-content">${professorName} êµìˆ˜ë‹˜ì˜ ê°•ì˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
                    </div>
                `;
                return;
            }

            // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ë¶„ë¦¬
            const isOnline = (it) => it.day === 'ONLINE' || (String(it.type||'').toLowerCase() === 'online') || (!it.day && !it.time);
            const offlineClasses = professorClasses.filter(it => !isOnline(it) && ['MON','TUE','WED','THU','FRI','SAT'].includes(it.day));
            const onlineClasses = professorClasses.filter(isOnline);

            // ì‹œê°„í‘œ ê·¸ë¦¬ë“œ ìƒì„± (30ë¶„ ë‹¨ìœ„ ë¹„ìœ¨ ê¸°ë°˜)
            const baseStart = '09:00';
            const baseEnd = '18:00';
            const slotMinutes = 30;
            const days = ['MON', 'TUE', 'WED', 'THU', 'FRI'];
            const dayNames = { 'MON': 'ì›”', 'TUE': 'í™”', 'WED': 'ìˆ˜', 'THU': 'ëª©', 'FRI': 'ê¸ˆ' };

            // ìœ í‹¸: HH:MM -> ì´ ë¶„, ë¶„ -> HH:MM
            const toMinutes = (hhmm) => {
                const [h, m] = hhmm.split(':').map(Number);
                return h * 60 + m;
            };
            const clamp = (val, min, max) => Math.max(min, Math.min(max, val));
            const baseStartMin = toMinutes(baseStart);
            const baseEndMin = toMinutes(baseEnd);

            const rowIndexFor = (hhmm) => {
                const mins = clamp(toMinutes(hhmm), baseStartMin, baseEndMin);
                const steps = Math.floor((mins - baseStartMin) / slotMinutes);
                return 2 + steps; // 1í–‰ì€ í—¤ë”, ì‹¤ì œ íƒ€ì„ë¼ì¸ì€ 2í–‰ë¶€í„° ì‹œì‘
            };
            const spanRowsFor = (start, end) => {
                const s = clamp(toMinutes(start), baseStartMin, baseEndMin);
                const e = clamp(toMinutes(end), baseStartMin, baseEndMin);
                const duration = Math.max(0, e - s);
                return Math.max(1, Math.ceil(duration / slotMinutes));
            };

            // í†µê³„ ê³„ì‚°
            const totalSubjects = new Set(professorClasses.map(c => c.subject)).size;
            const totalClasses = professorClasses.length;
            const buildings = new Set(offlineClasses.map(c => c.building_name)).size;

            let timetableHTML = `
                <div class="timetable-container">
                    <div class="timetable-header">
                        <h3>ğŸ‘¨â€ğŸ« ${professorName} êµìˆ˜ë‹˜ ì‹œê°„í‘œ</h3>
                    </div>
                    
                    <div class="timetable-stats">
                        <div class="timetable-stat">
                            <div class="timetable-stat-number">${totalSubjects}</div>
                            <div class="timetable-stat-label">ë‹´ë‹¹ ê³¼ëª©</div>
                        </div>
                        <div class="timetable-stat">
                            <div class="timetable-stat-number">${totalClasses}</div>
                            <div class="timetable-stat-label">ì´ ê°•ì˜</div>
                        </div>
                        <div class="timetable-stat">
                            <div class="timetable-stat-number">${buildings}</div>
                            <div class="timetable-stat-label">ì‚¬ìš© ê±´ë¬¼</div>
                        </div>
                    </div>

                    <div class="timetable-scale-wrap">
                    <div class="timetable-grid-30">
                        <div class="timetable-header-cell" style="grid-column: 1; grid-row: 1;">ì‹œê°„</div>
                        <div class="timetable-header-cell" style="grid-column: 2; grid-row: 1;">${dayNames['MON']}</div>
                        <div class="timetable-header-cell" style="grid-column: 3; grid-row: 1;">${dayNames['TUE']}</div>
                        <div class="timetable-header-cell" style="grid-column: 4; grid-row: 1;">${dayNames['WED']}</div>
                        <div class="timetable-header-cell" style="grid-column: 5; grid-row: 1;">${dayNames['THU']}</div>
                        <div class="timetable-header-cell" style="grid-column: 6; grid-row: 1;">${dayNames['FRI']}</div>
            `;

            // ì‹œê°„ ë¼ë²¨ (ì •ê°ë§Œ í‘œì‹œ) - 18:00ì€ ê·¸ë¦¬ë“œ ê²½ê³„ë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì œì™¸
            for (let mins = toMinutes(baseStart); mins < toMinutes(baseEnd); mins += 60) {
                const h = String(Math.floor(mins / 60)).padStart(2, '0');
                const m = String(mins % 60).padStart(2, '0');
                const time = `${h}:${m}`;
                const row = rowIndexFor(time);
                timetableHTML += `<div class="time-label" style="grid-column: 1; grid-row: ${row};">${time}</div>`;
            }

            // ê°•ì˜ ë¸”ë¡ ë°°ì¹˜
            const dayToCol = { 'MON': 2, 'TUE': 3, 'WED': 4, 'THU': 5, 'FRI': 6 };
            
            // ëª¨ë°”ì¼ìš©: ìš”ì¼ë³„ë¡œ ê·¸ë£¹í™”í•˜ê³  ì‹œê°„ìˆœ ì •ë ¬
            const classByDay = {};
            days.forEach(d => { classByDay[d] = []; });
            offlineClasses.forEach(cls => {
                if (days.includes(cls.day)) {
                    classByDay[cls.day].push(cls);
                }
            });
            Object.keys(classByDay).forEach(day => {
                classByDay[day].sort((a, b) => a.start.localeCompare(b.start));
            });

            // ë¸”ë¡ ë Œë”ë§ (ëª¨ë°”ì¼: data-day/data-time ì†ì„± ì¶”ê°€, ë°ìŠ¤í¬í†±: grid ìœ„ì¹˜)
            days.forEach(day => {
                classByDay[day].forEach(cls => {
                    const col = dayToCol[cls.day];
                    const rowStart = rowIndexFor(cls.start.substring(0,5));
                    const rowSpan = spanRowsFor(cls.start.substring(0,5), cls.end.substring(0,5));
                    const room = getRoomDisplay(cls);
                    const title = `${cls.subject} - ${room}`;
                    const dayLabel = dayNames[day];
                    const timeRange = `${cls.start.substring(0,5)}~${cls.end.substring(0,5)}`;
                    
                    timetableHTML += `
                        <div class="class-block" 
                             title="${title}"
                             data-day="${dayLabel}"
                             data-time="${timeRange}"
                             style="grid-column: ${col}; grid-row: ${rowStart} / span ${rowSpan};">
                            <div class="class-subject">${cls.subject}</div>
                            <div class="class-room">${room} Â· ${timeRange}</div>
                        </div>
                    `;
                });
            });

            timetableHTML += `</div></div>`;

            timetableHTML += `</div>`;

            // ë©”ì¸ ê²°ê³¼ ì»¨í…Œì´ë„ˆì— ì‹œê°„í‘œ ë Œë”

            const resultsContainer = document.getElementById('schedule-results');
            resultsContainer.innerHTML = timetableHTML;

            // ì˜¨ë¼ì¸ ê°•ì˜ ëª©ë¡ ë Œë”ë§ (ìˆì„ ê²½ìš° ë³„ë„ ì˜ì—­)
            const onlineContainer = document.getElementById('online-courses-list');
            if (onlineContainer) {
                if (onlineClasses.length > 0) {
                    const onlineCards = `
                        <div class="card">
                            <div class="card-title">ğŸŒ ì˜¨ë¼ì¸ ê°•ì˜ (${onlineClasses.length}ê°œ)</div>
                            <div class="card-content">
                                <ul style="padding-left:18px;">
                                    ${onlineClasses.map(item => `
                                        <li><strong>${item.subject}</strong>${item.professor ? ` â€“ ${getProfessorDisplay(item)}` : ''}</li>
                                    `).join('')}
                                </ul>
                            </div>
                        </div>`;
                    onlineContainer.innerHTML = onlineCards;
                } else {
                    onlineContainer.innerHTML = '';
                }
            }

            // ë°©ê¸ˆ ì‚½ì…í•œ ì‹œê°„í‘œ ì»¨í…Œì´ë„ˆë¥¼ ì •í™•íˆ ì°¾ì•„ ì¦‰ì‹œ ìŠ¤ì¼€ì¼ ì ìš©
            const newTimetableContainer = resultsContainer.querySelector('.timetable-container');
            if (newTimetableContainer) {
                // ì¦‰ì‹œ 1íšŒ ì ìš©
                applyTimetableAutoScale(newTimetableContainer);
                // ë‹¤ìŒ í”„ë ˆì„ì—ì„œ í•œ ë²ˆ ë” ì ìš© (ë ˆì´ì•„ì›ƒ ê³„ì‚° ì•ˆì •í™”)
                requestAnimationFrame(() => applyTimetableAutoScale(newTimetableContainer));
                // ë§¤ìš° ì§§ì€ ì§€ì—° í›„ ì¬ì ìš© (ì¼ë¶€ ë¸Œë¼ìš°ì € ì•ˆì „ë§)
                setTimeout(() => applyTimetableAutoScale(newTimetableContainer), 0);
            }
        }

        function searchSchedule(searchType, query) {
            // ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ê²½ê³ 
            if (!timetableData || timetableData.length === 0) {
                const resultsContainer = document.getElementById('schedule-results');
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤</div>
                        <div class="card-content">ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</div>
                    </div>
                `;
                return;
            }

            // ê²€ìƒ‰ì–´ê°€ ë¹„ì–´ìˆìœ¼ë©´ ê²½ê³ 
            if (!query.trim()) {
                const resultsContainer = document.getElementById('schedule-results');
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">âš ï¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</div>
                        <div class="card-content">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•œ í›„ ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
                    </div>
                `;
                return;
            }

            // êµìˆ˜ ì‹œê°„í‘œê°€ ì•„ë‹Œ ì¼ë°˜ ê²€ìƒ‰ì—ì„œëŠ” ì˜¨ë¼ì¸ ì˜ì—­ ì´ˆê¸°í™”
            const onlineContainer = document.getElementById('online-courses-list');
            if (onlineContainer) onlineContainer.innerHTML = '';

            let results = [];
            const searchQuery = query.toLowerCase().trim();
            const dayFilter = document.getElementById('schedule-day-filter').value;

            switch(searchType) {
                case 'department':
                    results = timetableData.filter(item => 
                        item.department.toLowerCase().includes(searchQuery) || 
                        item.college.toLowerCase().includes(searchQuery)
                    );
                    break;
                case 'professor':
                    results = timetableData.filter(item => {
                        const single = item.professor ? item.professor.toLowerCase() : '';
                        const anyMulti = Array.isArray(item.professors) && item.professors.some(n => (n || '').toLowerCase().includes(searchQuery));
                        return (single.includes(searchQuery)) || anyMulti;
                    });
                    break;
                case 'classroom':
                    results = timetableData.filter(item => 
                        item.classroom.toLowerCase().includes(searchQuery) || 
                        item.building_name.toLowerCase().includes(searchQuery)
                    );
                    break;
                case 'subject':
                    results = timetableData.filter(item => 
                        item.subject.toLowerCase().includes(searchQuery)
                    );
                    break;
                case 'missing-professor':
                    results = timetableData.filter(item => {
                        const hasSingle = item.professor && item.professor.trim() !== '';
                        const hasMulti = Array.isArray(item.professors) && item.professors.length > 0;
                        return !(hasSingle || hasMulti);
                    });
                    break;
            }

            // ìš”ì¼ í•„í„° ì ìš©
            if (dayFilter) {
                results = results.filter(item => item.day === dayFilter);
            }

            // ê²°ê³¼ë¥¼ ì‹œê°„ìˆœìœ¼ë¡œ ì •ë ¬ (ì˜¨ë¼ì¸ì€ ë§ˆì§€ë§‰)
            results.sort((a, b) => {
                const dayOrder = { 'MON': 1, 'TUE': 2, 'WED': 3, 'THU': 4, 'FRI': 5, 'SAT': 6, 'ONLINE': 99 };
                if (dayOrder[a.day] !== dayOrder[b.day]) {
                    return dayOrder[a.day] - dayOrder[b.day];
                }
                const sa = a.start || '';
                const sb = b.start || '';
                return sa.localeCompare(sb);
            });

            // ê²°ê³¼ ë Œë”ë§
            const resultsContainer = document.getElementById('schedule-results');
            const dayNames = {
                'MON': 'ì›”ìš”ì¼', 'TUE': 'í™”ìš”ì¼', 'WED': 'ìˆ˜ìš”ì¼',
                'THU': 'ëª©ìš”ì¼', 'FRI': 'ê¸ˆìš”ì¼', 'SAT': 'í† ìš”ì¼', 'ONLINE': 'ì˜¨ë¼ì¸'
            };

            if (results.length > 0) {
                // ê²°ê³¼ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì œí•œ
                const maxResults = 50;
                const displayResults = results.slice(0, maxResults);
                const hasMore = results.length > maxResults;

                const scheduleCards = displayResults.map(item => {
                    const isOnline = item.day === 'ONLINE' || (String(item.type||'').toLowerCase() === 'online');
                    if (isOnline) {
                        return `
                        <div class="card">
                            <div class="card-title">ğŸ“š ${item.subject} <span class="badge" style="margin-left:6px;">ì˜¨ë¼ì¸</span></div>
                            <div class="card-content">
                                ${item.professor ? `ğŸ‘¨â€ğŸ« ${getProfessorDisplay(item)}<br>` : ''}
                                ğŸ“‹ ${item.code}
                            </div>
                        </div>`;
                    }
                    return `
                    <div class="card">
                        <div class="card-title">ğŸ“š ${item.subject}</div>
                        <div class="card-content">
                            ğŸ‘¨â€ğŸ« ${getProfessorDisplay(item)}<br>
                            ğŸ›ï¸ ${item.classroom} (${item.building_name})<br>
                            ğŸ“… ${dayNames[item.day]} ${item.start}-${item.end}<br>
                            ğŸ« ${item.department}<br>
                            ğŸ“‹ ${item.code}
                        </div>
                    </div>`;
                }).join('');

                let resultHtml = `
                    <div class="search-info">
                        <p>ğŸ” ê²€ìƒ‰ ê²°ê³¼: <strong>${results.length}ê°œ</strong> ë°œê²¬</p>
                        ${hasMore ? `<p>âš ï¸ ì²˜ìŒ ${maxResults}ê°œë§Œ í‘œì‹œë©ë‹ˆë‹¤. ë” êµ¬ì²´ì ì¸ ê²€ìƒ‰ì–´ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”.</p>` : ''}
                    </div>
                ` + scheduleCards;

                resultsContainer.innerHTML = resultHtml;
            } else {
                resultsContainer.innerHTML = `
                    <div class="card">
                        <div class="card-title">ğŸ” ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>
                        <div class="card-content">
                            ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”.
                        </div>
                    </div>
                `;
            }
        }

        // ===== 3.5. ê¸°ëŠ¥ 4: ìº í¼ìŠ¤ í˜¼ì¡ë„ (Heatmap) =====
        function renderHeatmapChart() {
            // ë°ì´í„°ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ìœ¼ë©´ ëŒ€ê¸°
            if (!timetableData || timetableData.length === 0) {
                setTimeout(renderHeatmapChart, 1000); // 1ì´ˆ í›„ ë‹¤ì‹œ ì‹œë„
                return;
            }

            const ctx = document.getElementById('heatmap-chart').getContext('2d');

            // ê±´ë¬¼ë³„ ê°•ì˜ ìˆ˜ ì§‘ê³„
            const buildingData = {};
            timetableData.forEach(item => {
                if (!buildingData[item.building_name]) {
                    buildingData[item.building_name] = 0;
                }
                buildingData[item.building_name]++;
            });

            const buildings = Object.keys(buildingData);
            const counts = Object.values(buildingData);

            // ëª¨ë°”ì¼ ê°ì§€ (768px ë¯¸ë§Œ)
            const isMobile = window.innerWidth < 768;
            const chartType = 'bar'; // Chart.js v3+ì—ì„œëŠ” 'bar' ì‚¬ìš©
            const indexAxis = isMobile ? 'y' : 'x'; // ëª¨ë°”ì¼: ê°€ë¡œ, ë°ìŠ¤í¬í†±: ì„¸ë¡œ

            new Chart(ctx, {
                type: chartType,
                data: {
                    labels: buildings,
                    datasets: [{
                        label: 'ê°•ì˜ ìˆ˜',
                        data: counts,
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(255, 107, 107, 0.8)',
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(241, 196, 15, 0.8)',
                            'rgba(230, 126, 34, 0.8)',
                            'rgba(149, 165, 166, 0.8)',
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(26, 188, 156, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(118, 75, 162, 1)',
                            'rgba(255, 107, 107, 1)',
                            'rgba(52, 152, 219, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(241, 196, 15, 1)',
                            'rgba(230, 126, 34, 1)',
                            'rgba(149, 165, 166, 1)',
                            'rgba(155, 89, 182, 1)',
                            'rgba(26, 188, 156, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: indexAxis, // ëª¨ë°”ì¼: 'y' (ê°€ë¡œ), ë°ìŠ¤í¬í†±: 'x' (ì„¸ë¡œ)
                    responsive: true,
                    maintainAspectRatio: false, // ì»¨í…Œì´ë„ˆì— ë§ê²Œ í¬ê¸° ì¡°ì •
                    plugins: {
                        title: {
                            display: true,
                            text: 'ê±´ë¬¼ë³„ ê°•ì˜ ê°œì„¤ í˜„í™©',
                            font: {
                                size: isMobile ? 14 : 16,
                                weight: 'bold'
                            }
                        },
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    size: isMobile ? 10 : 12
                                }
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                font: {
                                    size: isMobile ? 10 : 12
                                }
                            }
                        }
                    }
                }
            });
        }

        // ===== 3.6. ê¸°ëŠ¥ 5: ì ì‹¬ ë£°ë › (Roulette) =====
        function initializeRouletteSection() {
            const rouletteButton = document.getElementById('roulette-button');
            
            rouletteButton.addEventListener('click', function() {
                spinRoulette();
            });
        }

        function spinRoulette() {
            const button = document.getElementById('roulette-button');
            const resultContainer = document.getElementById('roulette-result');

            // ë²„íŠ¼ ë¹„í™œì„±í™” ë° ë¡œë”© í‘œì‹œ
            button.disabled = true;
            button.textContent = 'ğŸ° ëŒë¦¬ëŠ” ì¤‘...';

            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ìœ„í•œ ë”œë ˆì´
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * restaurantsData.length);
                const selectedRestaurant = restaurantsData[randomIndex];

                // ê²°ê³¼ í‘œì‹œ
                resultContainer.innerHTML = `
                    <div class="roulette-result">
                        <h3>ğŸ‰ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë§›ì§‘!</h3>
                        <h2>${selectedRestaurant.name}</h2>
                        <p>ë¶„ë¥˜: ${selectedRestaurant.category}</p>
                        <p>ì¶”ì²œ ë©”ë‰´: ${selectedRestaurant.menu}</p>
                    </div>
                `;

                // ë²„íŠ¼ ë³µì›
                button.disabled = false;
                button.textContent = 'ğŸ° ë‹¤ì‹œ ëŒë¦¬ê¸°';
            }, 1500);
        }
    </script>
    <script>
        // ì‹œê°„í‘œ ìë™ ìŠ¤ì¼€ì¼ë§: ëª¨ë°”ì¼(<768px)ì—ì„œ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ì— ë§ì¶° ê·¸ë¦¬ë“œë¥¼ ì¶•ì†Œ
        function applyTimetableAutoScale(container) {
            if (!container) return;
            const wrap = container.querySelector('.timetable-scale-wrap');
            const grid = container.querySelector('.timetable-grid-30');
            if (!wrap || !grid) return;

            // ì´ˆê¸°í™”
            grid.style.transform = 'none';

            const isMobile = window.innerWidth < 768;
            // ê¸°ë³¸ì ìœ¼ë¡œ ë°ìŠ¤í¬í†±ì€ ìŠ¤ì¼€ì¼ 1 ìœ ì§€
            let scale = 1;
            if (isMobile) {
                const cw = container.clientWidth; // íŒ¨ë”©ì„ í¬í•¨í•œ ê°€ìš© ë„ˆë¹„
                const gw = grid.scrollWidth;     // ê·¸ë¦¬ë“œ ì›ë³¸ ë„ˆë¹„
                if (gw > 0 && cw > 0 && gw > cw) {
                    scale = cw / gw; // ì»¨í…Œì´ë„ˆì— ë§ì¶”ë„ë¡ ì¶•ì†Œ
                }
                // ëª¨ë°”ì¼ì—ì„œëŠ” ê°€ë¡œ ìŠ¤í¬ë¡¤ ì œê±°
                container.style.overflowX = 'hidden';
            } else {
                // ë°ìŠ¤í¬í†±ì—ì„œëŠ” ê¸°ì¡´ ë™ì‘ ìœ ì§€ (í•„ìš”ì‹œ ê°€ë¡œ ìŠ¤í¬ë¡¤ í—ˆìš©)
                container.style.overflowX = 'auto';
            }

            grid.style.transformOrigin = 'top left';
            grid.style.transform = `scale(${scale})`;

            // ìŠ¤ì¼€ì¼ëœ ë†’ì´ë¥¼ ë˜í¼ì— ë°˜ì˜í•´ ë ˆì´ì•„ì›ƒ ë¶•ê´´ ë°©ì§€
            const gridHeight = grid.offsetHeight; // ë¹„ìŠ¤ì¼€ì¼ ë†’ì´
            wrap.style.height = (gridHeight * scale) + 'px';
        }

        function applyAllTimetablesScale() {
            document.querySelectorAll('.timetable-container').forEach(container => {
                applyTimetableAutoScale(container);
            });
        }

        // ë¦¬ì‚¬ì´ì¦ˆ/ë°©í–¥ ì „í™˜ ì‹œ ì¬ê³„ì‚°
        window.addEventListener('resize', applyAllTimetablesScale);
        window.addEventListener('orientationchange', applyAllTimetablesScale);
    </script>
</body>
</html>